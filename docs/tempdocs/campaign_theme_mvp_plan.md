# Campaign Theme MVP Implementation

## 1. Общая стратегия
- Соблюсти функционал из `campaign_theme_strategy.md`, но реализовать в виде концептуального прототипа с упрощённой архитектурой.
- Использовать статический набор тем и персон, переключаемый через UI конструктора.
- Моделировать API и аналитику на mock-данных, показывая end-to-end сценарий.

## 2. Базовый конфиг кампании
- Добавить к кампании поле `themeConfig` (JSON) с ключами:
  - `themeId`
  - `funnelType`
  - `personas` (массив)
  - `gamificationLevel`
  - `motivationOverrides` (map терминов)
  - `assets` (пути к иконкам/фону/аудио)
- Хранить пресеты тем и персон в `data/theme-presets.ts` и `data/persona-presets.ts`.
- Для MVP достаточно 3 тем и 3 персон (например: студенты, специалисты, производственные).

## 3. Панель настроек кампании (конструктор)
- Расширить `MissionFlowEditor` маленькой панелью “Campaign Settings”.
- Элементы панели:
  - Select «Тип воронки» (подтягивает дефолтные мотиваторы).
  - Checkboxes для персон (с краткими описаниями и уровнем геймификации).
  - Карточки тем (из пресетов) с предпросмотром палитры и иконки мотивации.
  - Превью «до/после» для ЛК кадета (можно iframe или просто карточка).
- При изменениях панель обновляет локальный state и вызывает `/api/campaigns/[id]` (mock PUT) для сохранения `themeConfig`.
- Показать текущую конфигурацию в JSON-блоке (debug-pane) для демонстрации.

## 4. Темизация клиентских компонентов
- Создать `ThemeContext` и `useCampaignTheme()`.
- Компоненты для обновления:
  - `MissionNode`: раскраска, бейджи, иконки.
  - `CadetOverview`: карточки прогресса, названия валют, визуальные блоки.
  - `CadetGalacticMap`: фон, палитра узлов.
  - `TestModePanel`: HUD и статусы.
- Использовать токены из `themeConfig` (`primaryColor`, `badgeIcon`, `backgroundImage`).
- Применять `motivationOverrides` для текста (XP → Мана, и т.д.).
- Включить опциональный звук: при активации темы плейте фоновый аудиофайл из `public/themes/<theme>/ambient.mp3` (проверить разрешение).

## 5. Ассеты
- Разместить ассеты в `public/themes/<themeId>/`:
  - `background.png`
  - `icon.svg`
  - `audio.mp3`
- В config пресетов хранить относительные пути к этим файлам.
- Для MVP хотя бы по одному изображению и звуку на тему (допускается одно и то же изображение с цветным overlay).

## 6. AI Copilot (mock)
- Кнопка `ИИ-пилот` открывает модальное окно с выбором сценария “Generate Theme Config”.
- Форма принимает: тип воронки, целевую персону, желаемую тему.
- При нажатии “Generate” вызывается mock API `/api/ai/theme-suggestion` → возвращает заранее подготовленный `CampaignThemeConfig`.
- Показывать результат в JSON + кнопка «Apply» (применяет конфиг к кампании).
- Добавить фиктивный таймер и сообщение «AI is thinking…» для правдоподобности.

## 7. Аналитика воронки (POC)
- Реализовать `useFunnelMetrics()` в клиенте:
  - Возвращает массив событий (mock или синтезированные из миссий).
  - На основе `themeConfig` и `personas` рассчитывает конверсию по этапам (процент завершивших).
  - Оценивать drop-off по миссиям: если <40% выполняют, возвращать предупреждение.
- Добавить в конструктор блок “Funnel Analytics”:
  - Таблица по персонам: «Вход», «Средний прогресс», «Завершение».
  - График drop-off (может быть простой список со шкалой).
  - Подсветка проблемных миссий (баннер на соответствующих карточках).
- Настроить переключатель A/B (Variant A, Variant B) с mock разницей в конверсии + мини-барчарт.

## 8. Analytics-first сценарий
- Добавить кнопку “Get AI Recommendations” в блоке аналитики.
- При клике вызывать mock API `/api/ai/funnel-recommendation`, возвращающий список советов (e.g., сменить тему на `themeId`, переименовать мотиватор).
- Советы отображать списком чекбоксов, кнопка «Apply» изменяет текущий `themeConfig`.
- Подсветить соответствующие элементы в UI (например, сменить тему в превью).

## 9. Документация вовнутрь UI
- В панели кампании добавить кнопку “Info”/“Help” с мини-гайдом:
  - Что делает тема.
  - Как персон влияет на мотивацию.
  - Как AI помогает (прописать сценарий).
- В ЛК кадета выделить tooltip “This experience is themed by HR” (для демонстрации кастомизации).

## 10. API и мок-сервисы
- `/api/campaigns/[id]`: GET возвращает кампанию с `themeConfig`, PUT обновляет (можно хранить в памяти).
- `/api/ai/theme-suggestion`: возвращает заранее созданные конфиги (по 1 на сценарий).
- `/api/ai/funnel-recommendation`: возвращает массив рекомендаций (строки + JSON-патчи).
- Для демо можно реализовать эти маршруты внутри Next.js с in-memory объектами.

## 11. Тестовый сценарий демо
- Сценарий 1: Студенты (high gamification) → выбрать тему «Галактическая академия», показать ЛК кадета, включить звук.
- Сценарий 2: Опытные сотрудники (low gamification) → переключиться на тему «Корпоративный мегаполис», показать изменение терминологии.
- Показать блок аналитики: drop-off на миссии, как AI советует сменить тему для увеличения конверсии.
- Завершить демонстрацию показом JSON-конфига и кнопкой Apply от AI.

## 12. Дополнительные примечания
- Данные и ассеты могут быть заглушками, главное – продемонстрировать цепочку от настройки к пользовательскому опыту и аналитике.
- Все элементы UI должны быть кликабельны и показывать фидбек, даже если данные статичны.
- При необходимости использовать Storybook или отдельный Showcase для показа тем.
- Сохранить возможность расширения: текущие пресеты – это «seed», на будущее можно добавить CRUD.

