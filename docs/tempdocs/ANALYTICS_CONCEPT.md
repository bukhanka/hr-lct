# Концепция системы аналитики для HR-архитектора

## Главный принцип
**При открытии кампании HR должен за 10 секунд понять:**
1. Всё ли идёт по плану? (KPI к целям)
2. Где застряли пользователи? (Bottlenecks)
3. Что нужно исправить? (Action items)

---

## 1. Структура дашборда аналитики

### 📍 Главная страница кампании (/campaigns/[id])

#### Блок 1: **Бизнес-контекст и прогресс к целям** (уже есть BusinessContextPanel)
✅ Существует, но нужно дополнить:
- Прогресс к бизнес-цели (target vs actual)
- Timeline прогресса (сколько осталось до deadline)
- Статус достижения целей

#### Блок 2: **Real-Time Status Board** (НОВЫЙ)
Показывает живой статус прямо сейчас:
```
┌─────────────────────────────────────────────────────────────┐
│ 🔴 LIVE STATUS                                              │
├─────────────────────────────────────────────────────────────┤
│ 👥 147 активных кадетов     ⏱️ 12 в миссии прямо сейчас    │
│ 📈 +23 новых за последние 24ч                               │
│ ⚠️ 8 кадетов застряли на "Личное собеседование" >5 дней    │
└─────────────────────────────────────────────────────────────┘
```

#### Блок 3: **Goal Progress Dashboard** (НОВЫЙ)
Визуализация прогресса к целям из Campaign Brief:
```
Цель: 30 финальных офферов из 150 кандидатов (20% conversion)

┌──────────────────────────────────────────┐
│ Текущий прогресс: 18 / 30 офферов (60%) │
│ ████████████░░░░░░░░                     │
│                                          │
│ Конверсия: 12% (цель 20%) ⚠️             │
│ Осталось дней: 45                        │
│ Нужно ~0.27 офферов/день для достижения │
└──────────────────────────────────────────┘
```

#### Блок 4: **Conversion Funnel vs Targets** (НОВЫЙ)
Сравнение фактической воронки с целевой:
```
Этап                      | Цель    | Факт    | Статус
────────────────────────────────────────────────────────
Регистрация и тест        | 100%    | 100%    | ✅
Мотивационное эссе        | 80%     | 65%     | ⚠️  -15%
Просмотр брифинга         | 75%     | 58%     | ❌  -17%
Личное собеседование      | 40%     | 28%     | ❌  -12%
Финальная обратная связь  | 25%     | 12%     | ❌  -13%
```

#### Блок 5: **User Segments Overview** (НОВЫЙ)
```
┌────────────────────────────────────────────────────┐
│ 👥 Сегментация участников                         │
├────────────────────────────────────────────────────┤
│ 🚀 Active Champions (35%)      52 человека         │
│    > 3 миссии, активны <24ч                       │
│                                                    │
│ 🔄 In Progress (28%)           42 человека         │
│    1-2 миссии, активны <7 дней                    │
│                                                    │
│ ⏸️ Stalled (22%)               33 человека         │
│    Нет активности >7 дней                         │
│                                                    │
│ ❌ Dropped Off (15%)           23 человека         │
│    Не вернулись >30 дней                          │
└────────────────────────────────────────────────────┘
```

---

### 📊 Вкладка Analytics (/campaigns/[id]/analytics)

#### Блок 1: **Mission Performance Deep Dive**
Детальная аналитика по каждой миссии:
```
Миссия: "Мотивационное эссе"
┌─────────────────────────────────────────────────────┐
│ Метрики:                                            │
│ • Начали: 120 (из 150 registered)                  │
│ • Завершили: 78 (65% conversion) ⚠️                │
│ • В процессе: 12                                    │
│ • Dropped: 30                                       │
│                                                     │
│ Время прохождения:                                  │
│ • Среднее: 4.2 дня                                 │
│ • Медиана: 2 дня                                   │
│ • 90-перцентиль: 12 дней ⚠️                        │
│                                                     │
│ Drop-off точки:                                     │
│ • 15 бросили после скачивания шаблона              │
│ • 10 не отправили после загрузки файла             │
│ • 5 получили reject и не вернулись                 │
└─────────────────────────────────────────────────────┘
```

#### Блок 2: **Cohort Analysis**
Сравнение когорт пользователей:
```
Когорта по дате регистрации:

Неделя 1 (01-07 окт): 82% completion, avg 18 дней
Неделя 2 (08-14 окт): 75% completion, avg 21 дней ⚠️
Неделя 3 (15-21 окт): 68% completion, avg 25 дней ❌
Неделя 4 (22-28 окт): 45% in progress...
```

#### Блок 3: **Time-based Analytics**
```
📅 Активность по дням недели:
Понедельник: ████████ 34%
Вторник:     ██████ 28%
Среда:       ████ 18%
...

⏰ Пиковое время активности:
09:00-12:00: ████████████ (максимум)
14:00-18:00: ████████
19:00-22:00: ████
```

#### Блок 4: **User Journey Visualization**
Sankey diagram: показывает как пользователи движутся по воронке

---

### 👥 Вкладка Participants (/campaigns/[id]/participants)

Улучшения к существующему:

#### Добавить фильтры:
- По статусу (Active / Stalled / Dropped)
- По прогрессу (0-25%, 26-50%, 51-75%, 76-100%)
- По дате последней активности
- По рангу
- По конкретным миссиям

#### Добавить сортировки:
- По прогрессу (возрастание/убывание)
- По дате последней активности
- По количеству XP/маны
- По рангу

#### Добавить массовые действия:
- Выбрать группу пользователей
- Отправить уведомление
- Разблокировать миссию
- Сбросить прогресс группы

#### Детальная карточка пользователя (modal):
При клике на участника:
```
┌──────────────────────────────────────────────────┐
│ Алекс Новиков                                    │
│ cadet.student@example.com                        │
├──────────────────────────────────────────────────┤
│ Прогресс: 3/5 миссий (60%)                      │
│ Текущая миссия: "Брифинг от капитана"          │
│ Начал: 2 дня назад                              │
│                                                  │
│ Timeline активности:                             │
│ ✅ 01 окт - Тест на профпригодность             │
│ ✅ 03 окт - Мотивационное эссе                  │
│ ✅ 05 окт - Брифинг от капитана                 │
│ 🔄 07 окт - Личное собеседование (в процессе)   │
│ 🔒 Обратная связь (заблокирована)               │
│                                                  │
│ Компетенции:                                     │
│ • Аналитическое мышление: 5 pts                 │
│ • Коммуникация: 5 pts                           │
│ • Креативность: 4 pts                           │
└──────────────────────────────────────────────────┘
```

---

## 2. Новые API endpoints

### `/api/analytics/campaigns/[id]/live-status`
```json
{
  "activeNow": 12,
  "activeToday": 45,
  "new24h": 23,
  "stuckUsers": [
    {
      "userId": "...",
      "missionId": "...",
      "missionName": "Личное собеседование",
      "daysStuck": 5
    }
  ]
}
```

### `/api/analytics/campaigns/[id]/goal-progress`
```json
{
  "businessGoal": "30 офферов из 150 кандидатов",
  "target": {
    "total": 150,
    "finalOffers": 30,
    "conversionRate": 20
  },
  "actual": {
    "registered": 150,
    "completed": 18,
    "conversionRate": 12
  },
  "daysRemaining": 45,
  "dailyRateNeeded": 0.27,
  "onTrack": false
}
```

### `/api/analytics/campaigns/[id]/segments`
```json
{
  "activeChampions": { "count": 52, "percentage": 35 },
  "inProgress": { "count": 42, "percentage": 28 },
  "stalled": { "count": 33, "percentage": 22 },
  "droppedOff": { "count": 23, "percentage": 15 }
}
```

### `/api/analytics/campaigns/[id]/missions/[missionId]/deep`
```json
{
  "missionId": "...",
  "name": "Мотивационное эссе",
  "performance": {
    "started": 120,
    "completed": 78,
    "inProgress": 12,
    "dropped": 30,
    "conversionRate": 65
  },
  "timing": {
    "avgCompletionHours": 100.8,
    "medianCompletionHours": 48,
    "p90CompletionHours": 288
  },
  "dropoffPoints": [
    {
      "point": "after_template_download",
      "count": 15,
      "percentage": 50
    }
  ]
}
```

---

## 3. UI/UX принципы

### Цветовая индикация статуса:
- 🟢 Зелёный: выше цели (good)
- 🟡 Жёлтый: 5-15% ниже цели (warning)
- 🔴 Красный: >15% ниже цели (critical)

### Иерархия информации:
1. **Критичные проблемы** — наверху, красным
2. **Основные метрики** — крупно, визуально
3. **Детали** — в раскрывающихся секциях

### Actionable insights:
Не просто "65% conversion", а:
```
❌ 65% conversion (цель: 80%)
💡 Рекомендация: Упростите форму или добавьте 
   напоминание через 2 дня после скачивания шаблона
```

### Сравнения везде:
- Текущий период vs предыдущий
- Факт vs план
- Эта кампания vs средняя по компании

---

## 4. Приоритеты внедрения

### Phase 1 (MVP):
1. ✅ Goal Progress Dashboard на главной
2. ✅ Conversion Funnel vs Targets
3. ✅ Mission Performance Deep Dive
4. ✅ User Segments

### Phase 2:
1. Live Status Board
2. Cohort Analysis
3. Time-based Analytics
4. Детальные карточки пользователей

### Phase 3:
1. AI-рекомендации на основе данных
2. Predictive analytics (прогноз достижения целей)
3. Automated alerts (уведомления о проблемах)
4. Export в Excel/PDF

---

## 5. Технические требования

### Кеширование:
- Тяжелые запросы (cohorts, deep analytics) кешировать на 5-10 мин
- Live status обновлять каждые 30 сек

### Оптимизация запросов:
- Использовать агрегирующие запросы Prisma
- Материализованные представления для сложных метрик
- Пагинация для списков участников

### Real-time:
- WebSocket или Server-Sent Events для live status
- Или polling каждые 30 секунд


