# Тестирование системы тематизации кампаний

## Быстрый старт

### 1. Подготовка базы данных

```bash
cd app
npm run seed
```

Это создаст:
- 5 кампаний с разными темами
- 3 кадетов с прогрессом в разных кампаниях
- Ранги, компетенции, магазин

### 2. Запуск приложения

```bash
npm run dev
```

Откройте http://localhost:3000

## Сценарии тестирования

### Сценарий 1: Студент с высокой геймификацией

**Цель**: Проверить галактическую тему для молодой аудитории

1. **Вход**: http://localhost:3000/auth/sign-in
   - Выбрать "Алекс Новиков (Студент)"
   - Email: `cadet.student@example.com`

2. **Ожидаемый результат**:
   - ✅ Галактическая карта миссий (не роадмап)
   - ✅ Космический фон с анимированными звёздами
   - ✅ Фиолетовые акценты (#8B5CF6)
   - ✅ Терминология: "Опыт", "Энергия", "Ранг"
   - ✅ Миссии на космической карте с эффектами свечения
   - ✅ Показано 3/5 миссий завершено
   - ✅ 250 Опыта, 120 Энергии, Ранг 2

3. **Что проверить**:
   - Клик на узел миссии → открывается детальная информация
   - Завершённые миссии имеют зелёное свечение
   - Доступные миссии подсвечены фиолетовым
   - Заблокированные миссии серые

---

### Сценарий 2: Специалист с низкой геймификацией

**Цель**: Проверить корпоративную тему для профессионалов

1. **Вход**: http://localhost:3000/auth/sign-in
   - Выбрать "Мария Соколова (Специалист)"
   - Email: `cadet.pro@example.com`

2. **Ожидаемый результат**:
   - ✅ Вертикальный роадмап (не галактическая карта)
   - ✅ Строгий, минималистичный дизайн
   - ✅ Голубые акценты (#38BDF8)
   - ✅ Терминология: "KPI", "Бонусы", "Статус"
   - ✅ Миссии в виде карточек на таймлайне
   - ✅ Показано 2/3 миссий завершено
   - ✅ 450 KPI, 80 Бонусов, Статус 3

3. **Что проверить**:
   - Таймлайн с соединительными линиями между миссиями
   - Завершённые миссии с галочкой
   - Клик на карточку открывает детали
   - Нет "космических" эффектов
   - Фокус на метриках и прогрессе

---

### Сценарий 3: Волонтёр ESG

**Цель**: Проверить ESG тему с балансированной геймификацией

1. **Вход**: http://localhost:3000/auth/sign-in
   - Выбрать "Иван Зеленский (Волонтёр)"
   - Email: `cadet.volunteer@example.com`

2. **Ожидаемый результат**:
   - ✅ Вертикальный роадмап
   - ✅ Зелёные акценты (#22C55E)
   - ✅ Терминология: "Вклад", "Импакт", "Статус"
   - ✅ ESG-ориентированный дизайн
   - ✅ Показано 2/3 миссий завершено
   - ✅ 180 Вклада, 200 Импакта, Статус 2

3. **Что проверить**:
   - Роадмап-представление
   - Зелёная цветовая палитра
   - Социальная/волонтёрская терминология
   - Баланс между геймификацией и серьёзностью

---

### Сценарий 4: Настройка темы архитектором

**Цель**: Проверить панель настроек кампании

1. **Вход**: http://localhost:3000/auth/sign-in
   - Выбрать "Елена Архитектор"
   - Email: `architect@example.com`

2. **Навигация**:
   - Перейти в "Кампании"
   - Выбрать любую кампанию (например, "Путь в космос")
   - Перейти на вкладку "Настройки"

3. **Что тестировать**:

   **a) Выбор воронки**:
   - ✅ Dropdown с 5 опциями
   - ✅ Адаптация, Вовлечение, Отбор, Развитие, Ценности
   - ✅ Выбор воронки влияет на рекомендуемую тему

   **b) Выбор персон**:
   - ✅ Checkboxes для 3 персон
   - ✅ Студенты, Специалисты, Волонтёры
   - ✅ Можно выбрать несколько

   **c) Выбор темы**:
   - ✅ 3 карточки тем с превью цветов
   - ✅ Галактическая академия (фиолетовый)
   - ✅ Корпоративный мегаполис (голубой)
   - ✅ ESG-миссия (зелёный)
   - ✅ Активная тема подсвечена

   **d) Уровень геймификации**:
   - ✅ 3 кнопки: Мин / Сбал / Макс
   - ✅ Переключение работает

   **e) Терминология**:
   - ✅ 3 поля ввода: Очки опыта, Валюта, Ранг
   - ✅ Можно переименовать (например, XP → Баллы)
   - ✅ Изменения сохраняются

   **f) ИИ-помощник**:
   - ✅ Кнопка "ИИ-пилот"
   - ✅ Модальное окно с подтверждением
   - ✅ Имитация задержки генерации (0.8-2 сек)
   - ✅ Применение сгенерированной темы

   **g) Debug-панель**:
   - ✅ Кнопка "Глаз" для показа JSON
   - ✅ Отображение текущей конфигурации
   - ✅ Валидный JSON формат

   **h) Tooltips**:
   - ✅ Иконки "?" рядом с каждым разделом
   - ✅ Наведение показывает подсказку
   - ✅ Подсказки информативны

4. **Сохранение**:
   - ✅ Кнопка "Сохранить изменения"
   - ✅ Индикатор загрузки
   - ✅ Уведомление об успехе
   - ✅ Изменения применяются в режиме тестирования

---

### Сценарий 5: Режим тестирования

**Цель**: Проверить применение темы в тестовом режиме

1. **Вход как Architect**: `architect@example.com`

2. **Навигация**:
   - Открыть кампанию "Путь в космос"
   - Перейти на вкладку "Конструктор"
   - Нажать кнопку "Режим тестирования" (справа сверху)

3. **URL**: `/dashboard/architect/campaigns/{id}/test`

4. **Ожидаемый результат**:
   - ✅ Интерфейс кадета загружается
   - ✅ Тема кампании применена автоматически
   - ✅ Цвета соответствуют настройкам
   - ✅ Терминология из настроек (XP/Мана)
   - ✅ Визуальное оформление (галактическая карта для этой кампании)

5. **Тестирование миссий**:
   - ✅ Клик на миссию открывает детали
   - ✅ Кнопка "Быстрый тест" работает
   - ✅ Миссия переходит в статус "Завершено"
   - ✅ Обновляется прогресс (XP, Мана)
   - ✅ Открывается следующая миссия

6. **Кнопка "Сбросить"**:
   - ✅ Сбрасывает весь прогресс
   - ✅ Все миссии возвращаются в начальное состояние

---

### Сценарий 6: Смена темы в реальном времени

**Цель**: Проверить, что изменения темы сразу видны

1. **Подготовка** (две вкладки браузера):
   - Вкладка 1: Architect → Настройки кампании "Путь в космос"
   - Вкладка 2: Architect → Режим тестирования той же кампании

2. **Действия**:
   - На вкладке 1: Сменить тему с "Галактическая академия" на "Корпоративный мегаполис"
   - Изменить терминологию: XP → "Баллы", Мана → "Кредиты"
   - Сохранить изменения

3. **Проверка на вкладке 2**:
   - ✅ Обновить страницу (F5)
   - ✅ Визуал изменился на корпоративный роадмап
   - ✅ Цвета изменились на голубые
   - ✅ Терминология обновилась: "Баллы", "Кредиты"

---

## API тестирование

### Тест AI генерации темы

```bash
curl -X POST http://localhost:3000/api/ai/theme-suggestion \
  -H "Content-Type: application/json" \
  -d '{
    "funnelType": "onboarding",
    "personaId": "students"
  }'
```

**Ожидаемый ответ**:
```json
{
  "generatedAt": "2025-...",
  "personaId": "students",
  "suggestion": {
    "themeId": "galactic-academy",
    "funnelType": "onboarding",
    "personas": ["students"],
    "gamificationLevel": "high",
    "motivationOverrides": { ... },
    "palette": { ... }
  }
}
```

### Тест AI рекомендаций

```bash
curl -X POST http://localhost:3000/api/ai/funnel-recommendation \
  -H "Content-Type: application/json" \
  -d '{
    "campaignId": "YOUR_CAMPAIGN_ID",
    "funnelType": "engagement"
  }'
```

**Ожидаемый ответ**:
```json
{
  "generatedAt": "2025-...",
  "campaignId": "...",
  "tips": [
    {
      "id": "theme-optimization",
      "title": "Оптимизировать визуальную тему",
      "summary": "Попробуйте тему ...",
      "patch": { ... }
    },
    ...
  ]
}
```

---

## Чеклист визуальной проверки

### Галактическая тема (galactic-academy)
- [ ] Фиолетовые градиенты (#8B5CF6)
- [ ] Анимированные звёзды на фоне
- [ ] Узлы миссий круглые, с эффектами свечения
- [ ] Изогнутые линии связей между миссиями
- [ ] Космический фон
- [ ] High gamification элементы

### Корпоративная тема (corporate-metropolis)
- [ ] Голубые акценты (#38BDF8)
- [ ] Вертикальный роадмап
- [ ] Строгие прямоугольные карточки
- [ ] Минимум визуальных эффектов
- [ ] Фокус на метриках
- [ ] Low gamification

### ESG тема (esg-mission)
- [ ] Зелёные акценты (#22C55E)
- [ ] Вертикальный роадмап
- [ ] Сбалансированный дизайн
- [ ] Природные/социальные мотивы
- [ ] Balanced gamification

---

## Проблемы и решения

### Тема не применяется в интерфейсе кадета

**Возможные причины**:
1. ThemeProvider не обёрнут вокруг компонента
2. Кампания не имеет `themeConfig`
3. API не возвращает тему

**Решение**:
```bash
# Пересеять базу
npm run seed

# Проверить API
curl http://localhost:3000/api/campaigns/{id} | jq .themeConfig
```

### Терминология не меняется

**Проверить**:
- Настройки сохранены в `themeConfig.motivationOverrides`
- `getMotivationText()` вызывается в компоненте
- ThemeProvider передаёт правильную тему

### Роадмап показывается вместо галактической карты

**Причина**: `themeId` не равен `"galactic-academy"`

**Решение**: Проверить в настройках кампании выбранную тему

---

## Метрики успеха MVP

✅ **Реализовано**:
- 3 темы с разными визуалами
- 3 типа кадетов для тестирования
- Панель настроек для архитектора
- AI помощник (мок)
- Адаптивный интерфейс кадета
- Тестовый режим с темизацией

✅ **Готово к демо**:
- End-to-end сценарий от настройки до отображения
- Различные визуальные режимы
- Терминология адаптируется
- Тестовые данные в базе

## Следующие шаги

Для продакшн-релиза:
1. Добавить реальные ассеты (фоны, иконки)
2. Реализовать аналитику воронки
3. Добавить больше тем
4. Интегрировать реальный AI (GPT-4/Claude)
5. A/B тестирование с метриками
